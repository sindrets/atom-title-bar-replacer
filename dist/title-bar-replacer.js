var $=Object.create,F=Object.defineProperty,Y=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty,Q=Object.getOwnPropertyNames,X=Object.getOwnPropertyDescriptor;var z=u=>F(u,"__esModule",{value:!0});var Z=(u,e)=>{z(u);for(var t in e)F(u,t,{get:e[t],enumerable:!0})},ee=(u,e,t)=>{if(z(u),e&&typeof e=="object"||typeof e=="function")for(let i of Q(e))!J.call(u,i)&&i!=="default"&&F(u,i,{get:()=>e[i],enumerable:!(t=X(e,i))||t.enumerable});return u},k=u=>u&&u.__esModule?u:ee(F(u!=null?$(Y(u)):{},"default",{value:u,enumerable:!0}),u);Z(exports,{ApplicationMenu:()=>f,Diff:()=>R,EditToken:()=>M,MenuUpdater:()=>L,activate:()=>te,config:()=>G,deactivate:()=>ie,deserialize:()=>le,serialize:()=>ne});var j=k(require("atom"));var B=class{static createStyleSheet(e=B.defaultId,t){let i=document.createElement("style");return i.id=e.replace(/[.#]/,""),t&&i.classList.add(t),i.appendChild(document.createTextNode("")),document.head&&document.head.appendChild(i),i.sheet}static styleExists(e=`#${B.defaultId}`){return document.querySelector(e)!==null}static getStyleSheet(e=`#${B.defaultId}`,t){if(!this.styleExists(e))return this.createStyleSheet(e,t);let i=e;t&&(i+="."+t);let n=document.querySelector(i),l=null;return n&&(l=n.sheet),l}static clearRule(e,t=`#${B.defaultId}`){let i=this.getStyleSheet(t);if(!!i){for(let n=0;n<i.cssRules.length;n++)i.cssRules[n].selectorText==e&&i.removeRule(n);return i}}},T=B;T.defaultId="tbr-style";var y=Object.freeze({MOUSE_CLICK:Symbol(),MOUSE_ENTER:Symbol(),MOUSE_LEAVE:Symbol()}),H=class{constructor(){this.displayTitleBar=!1;this.displayMenuBar=!1;this.openAdjacent=!1;this.autoHide=!1;this.hideFullscreenTitle=!1;this.altGivesFocus=!1;this.menuBarMnemonics=!1;this.autoSelectColor=!1;this.titleBarStyle="Spacious";this.windowControlTheme="";this.reverseWindowControls=!1}},U={Spacious:{cssId:"tbr-style-spacious"},Compact:{cssId:"tbr-style-compact"}},P={"Windows 10":{cssClass:"control-theme-windows-10"},Arc:{cssClass:"control-theme-arc"},Yosemite:{cssClass:"control-theme-yosemite"},Legacy:{cssClass:"control-theme-legacy"}},C={base:[".title-bar-replacer, .title-bar-replacer::before",".app-menu .menu-label.open, .app-menu .menu-label:hover, .app-menu .menu-label.open, .app-menu .menu-label.focused",".app-menu .menu-label .menu-box"],hi:[".app-menu .menu-label .menu-box .menu-item.open, .app-menu .menu-label .menu-box .menu-item.selected"],txt:[".title-bar-replacer",".title-bar-replacer .custom-title, .app-menu .menu-label .menu-box hr, .app-menu .menu-label .menu-box .menu-item .menu-item-keystroke, .app-menu .menu-label .menu-box .menu-item.disabled",".tbr-title-bar i, .tbr-title-bar i.disabled, .app-menu .menu-label .menu-box .menu-item"]},K=["application:open-terms-of-use","application:open-documentation","application:open-faq","application:open-discussions","application:report-issue","application:search-issues"];var a=class{static formatAltKey(e){let t=e.match(/(?<=&)./),i=t?t[0]:null;return{html:e.replace(`&${i}`,`<u>${i}</u>`),name:e.replace("&",""),key:(i==null?void 0:i.toLowerCase())||null}}static setToggleClass(e,t,i){i?e.classList.add(t):e.classList.remove(t)}static mod(e,t){return(e%t+t)%t}static clamp(e,t,i){return e<t?t:e>i?i:e}static stopEvent(e){e.stopPropagation(),e.preventDefault()}static rangeIntersects(e,t,i,n){return Math.max(e,t)>=Math.min(i,n)&&Math.min(e,t)<=Math.max(i,n)}static domRectIntersects(e,t){return a.rangeIntersects(e.x,e.x+e.width,t.x,t.x+t.width)&&a.rangeIntersects(e.y,e.y+e.height,t.y,t.y+t.height)}};var h=class{constructor(e){this.view=e}setTitleBarStyle(e){let t=U[e];!t||(this.style&&this.view.getElement().classList.remove(this.style.cssId),this.view.getElement().classList.add(t.cssId),this.style=t)}setWindowControlTheme(e){let t=P[e];!t||(this.controlTheme&&this.view.getElement().classList.remove(this.controlTheme.cssClass),this.view.getElement().classList.add(t.cssClass),this.controlTheme=t)}setReverseWindowControls(e){a.setToggleClass(this.view.getElement(),"reverse-controls",e)}static getLuminance(e){return(e.red*299+e.green*587+e.blue*114)/1e3/255}static shadeColor(e,t){let i=t<0?0:255,n=t<0?t*-1:t;return new e.constructor(Math.round((i-e.red)*n)+e.red,Math.round((i-e.green)*n)+e.green,Math.round((i-e.blue)*n)+e.blue,e.alpha)}static clearCustomColors(){C.base.forEach(e=>{T.clearRule(e)}),C.hi.forEach(e=>{T.clearRule(e)}),C.txt.forEach(e=>{T.clearRule(e)})}static applyCustomColors(){let e=T.getStyleSheet();if(!e)return;let t=atom.config.get("title-bar-replacer.colors.baseColor"),i=atom.config.get("title-bar-replacer.colors.highlightColor"),n=atom.config.get("title-bar-replacer.colors.textColor");h.clearCustomColors();let l=h.getLuminance(t)>=.5?-1:1;e.insertRule(C.base[0]+"{ background-color: "+t.toHexString()+" !important }",e.cssRules.length),e.insertRule(C.base[1]+"{ background-color: "+h.shadeColor(t,-.4*l).toHexString()+" !important }",e.cssRules.length),e.insertRule(C.base[2]+"{ background-color: "+h.shadeColor(t,.1*l).toHexString()+" !important }",e.cssRules.length),e.insertRule(C.hi[0]+"{ background-color: "+i.toHexString()+" !important }",e.cssRules.length),l=h.getLuminance(n)>=.5?-1:1,e.insertRule(C.txt[0]+"{ color: "+n.toHexString()+" !important }",e.cssRules.length),e.insertRule(C.txt[1]+"{ color: "+h.shadeColor(n,.25*l).toHexString()+" !important }",e.cssRules.length),e.insertRule(C.txt[2]+"{ color: "+h.shadeColor(n,-.4*l).toHexString()+" !important }",e.cssRules.length)}};var _=k(require("events"));var N=k(require("events"));var A=class extends Error{constructor(){super(...arguments);this.name="MalformedTemplateError"}};var q=k(require("events"));var I=class extends Array{getSelected(){let e=null;return this.some(t=>t.isSelected()?(e=t,!0):!1),e}getSelectable(){return this.filter(e=>e.isEnabled()&&e.isVisible()&&!e.isSeparator())}selectFirstItem(){var t;let e=this.getSelectable();e.length<1||((t=this.getSelected())==null||t.setSelected(!1),e[0].setSelected(!0))}selectLastItem(){var t;let e=this.getSelectable();e.length<1||((t=this.getSelected())==null||t.setSelected(!1),e[e.length-1].setSelected(!0))}selectNextItem(){let e=this.getSelectable();if(e.length<=1)return;let t=this.getSelected();if(t){let i=e.indexOf(t);t.setSelected(!1),e[a.mod(i+1,e.length)].setSelected(!0)}}selectPreviousItem(){let e=this.getSelectable();if(e.length<=1)return;let t=this.getSelected();if(t){let i=e.indexOf(t);t.setSelected(!1),e[a.mod(i-1,e.length)].setSelected(!0)}}countSelectable(){let e=0;return this.forEach(t=>{t.isEnabled()&&t.isVisible()&&!t.isSeparator()&&e++}),e}};var x=k(require("electron")),v=class{constructor(e){this.separator=!1;this.enabled=!0;this.visible=!0;this.selected=!1;this.open=!1;this.element=e,this.emitter=new q.default,this.emitter.on(y.MOUSE_ENTER,(...t)=>this.onSubItemMouseEnter(t[0],t[1])),this.element.addEventListener("click",t=>this.onMouseClick(t)),this.element.addEventListener("mouseenter",t=>this.onMouseEnter(t))}static createMenuItem(e){var o;if(e.type=="separator"){let p=new v(document.createElement("hr"));return p.separator=!0,p}if(e.label===void 0)throw new A("Menu item template is malformed!");let t=document.createElement("div");t.classList.add("menu-item");let i=new v(t);e.enabled===!1&&(i.enabled=!1,t.classList.add("disabled")),e.visible===!1&&(i.visible=!1,t.classList.add("invisible"));let n=a.formatAltKey(e.label);t.setAttribute("alt-trigger",n.key),i.altTrigger=n.key||void 0,e.label==="VERSION"&&(n.html="Version "+atom.getVersion());let l=document.createElement("span");l.classList.add("menu-item-name"),l.innerHTML=n.html,i.labelText=e.label;let r=document.createElement("span");if(r.classList.add("menu-item-keystroke"),t.appendChild(l),t.appendChild(r),e.command!==void 0){i.command=e.command,i.commandDetail=e.commandDetail;let p=atom.keymaps.findKeyBindings({command:e.command});p.length>0&&(r.innerHTML=p[p.length-1].keystrokes)}return((o=e.submenu)==null?void 0:o.length)>0&&e.submenu.forEach(p=>{try{i.addChild(v.createMenuItem(p))}catch(b){console.error(b)}}),i}serialize(){var e;return{label:this.labelText,command:this.command,commandDetail:this.commandDetail,submenu:(e=this.submenu)==null?void 0:e.map(t=>t.serialize())}}onMouseClick(e){var t,i;e.stopPropagation(),(t=this.parent)==null||t.getEmitter().emit(y.MOUSE_CLICK,this,e),this.isExecutable()&&(this.execCommand(),(i=this.getAppMenuRoot())==null||i.close())}onMouseEnter(e){var t;e.stopPropagation(),(t=this.parent)==null||t.getEmitter().emit(y.MOUSE_ENTER,this,e)}onSubItemMouseEnter(e,t){var i;(i=this.submenu)==null||i.forEach(n=>{n.setOpen(!1),n.setSelected(!1)}),e.setSelected(!0),e.setOpen(!0)}async execCommand(){var t;if(this.command===void 0)return;if(K.indexOf(this.command)>-1){switch(this.command){case"application:open-terms-of-use":x.shell.openExternal("https://help.github.com/articles/github-terms-of-service/");break;case"application:open-documentation":x.shell.openExternal("http://flight-manual.atom.io/");break;case"application:open-faq":x.shell.openExternal("https://atom.io/faq");break;case"application:open-discussions":x.shell.openExternal("https://discuss.atom.io/");break;case"application:report-issue":x.shell.openExternal("https://github.com/atom/atom/blob/master/CONTRIBUTING.md#submitting-issues");break;case"application:search-issues":x.shell.openExternal("https://github.com/atom/atom/issues");break}return}let e=((t=atom.workspace.getActiveTextEditor())==null?void 0:t.getElement())||atom.workspace.getActivePane().getElement();await atom.commands.dispatch(e,this.command,this.commandDetail)}addChild(e){var t,i;if(!this.hasSubmenu()){this.submenu=new I,this.element.classList.add("has-sub");let n=document.createElement("div");n.classList.add("menu-box","menu-item-submenu"),this.element.appendChild(n)}e.setParent(this),(t=this.submenu)==null||t.push(e),(i=this.element.querySelector(".menu-box"))==null||i.appendChild(e.getElement())}insertChild(e,t){var n;if(!this.hasSubmenu()){this.submenu=new I,this.element.classList.add("has-sub");let l=document.createElement("div");l.classList.add("menu-box","menu-item-submenu"),this.element.appendChild(l)}e.setParent(this),(n=this.submenu)==null||n.splice(t,0,e);let i=this.element.querySelector(".menu-box");i==null||i.insertBefore(e.getElement(),i.children[t]||null)}removeChild(e){var i,n,l,r,o;if(e instanceof v){(n=this.submenu)==null||n.splice((i=this.submenu)==null?void 0:i.indexOf(e),1),(l=e.getElement().parentElement)==null||l.removeChild(e.getElement());return}let t=(r=this.submenu)==null?void 0:r.splice(e,1)[0];(o=t==null?void 0:t.getElement().parentElement)==null||o.removeChild(t==null?void 0:t.getElement())}getAppMenuRoot(){let e=this.parent;for(;e&&!(e instanceof f);)e=e.getParent();return e instanceof f?e:null}bounce(){let e=parseFloat(window.getComputedStyle(this.element).animationDuration)*1e3;this.element.classList.add("bounce"),setTimeout(()=>{this.element.classList.remove("bounce")},e)}getElement(){return this.element}getLabelText(){return this.labelText}isSeparator(){return this.separator}isEnabled(){return this.enabled}isVisible(){return this.visible}isSelected(){return this.selected}isOpen(){return this.open}getCommand(){return this.command}getCommandDetail(){return this.commandDetail}getAltTrigger(){return this.altTrigger}getSubmenu(){return this.submenu}hasSubmenu(){return this.submenu!==void 0}getEmitter(){return this.emitter}getParent(){return this.parent}isExecutable(){return this.enabled&&!this.separator&&!this.hasSubmenu()}setSelected(e){this.selected=e,e?this.element.classList.add("selected"):this.element.classList.remove("selected","open")}setOpen(e){var t;this.open=e,e||(t=this.submenu)==null||t.forEach(i=>{i.setOpen(!1),i.setSelected(!1)}),a.setToggleClass(this.element,"open",e)}setParent(e){this.parent=e}};var S=class{constructor(e){this.open=!1;this.focused=!1;this.element=e,this.submenu=new I,this.emitter=new N.default,this.emitter.on(y.MOUSE_CLICK,(...t)=>this.onSubItemClick(t[0],t[1])),this.emitter.on(y.MOUSE_ENTER,(...t)=>this.onSubItemMouseEnter(t[0],t[1])),this.element.addEventListener("click",t=>this.onMouseClick(t)),this.element.addEventListener("mouseenter",t=>this.onMouseEnter(t))}static createMenuLabel(e){if(e.label===void 0||!e.submenu)throw new A("Label template is malformed!");let t=document.createElement("span");t.classList.add("menu-label");let i=a.formatAltKey(e.label);t.setAttribute("label",i.name),t.setAttribute("alt-trigger",i.key),t.innerHTML=i.html;let n=new S(t);n.labelText=e.label,n.altTrigger=i.key||void 0;let l=document.createElement("div");return l.classList.add("menu-box"),t.appendChild(l),e.submenu.forEach(r=>{try{n.addChild(v.createMenuItem(r))}catch(o){console.error(o)}}),n}serialize(){return{label:this.labelText,submenu:this.submenu.map(e=>e.serialize())}}onMouseClick(e){var t;e.stopPropagation(),(t=this.parent)==null||t.getEmitter().emit(y.MOUSE_CLICK,this,e)}onMouseEnter(e){var t;e.stopPropagation(),(t=this.parent)==null||t.getEmitter().emit(y.MOUSE_ENTER,this,e)}onSubItemClick(e,t){}onSubItemMouseEnter(e,t){this.submenu.forEach(i=>{i.setOpen(!1),i.setSelected(!1)}),e.isEnabled()&&(e.setSelected(!0),e.hasSubmenu()&&e.setOpen(!0))}getElement(){return this.element}getLabelText(){return this.labelText}getSubmenu(){return this.submenu}isOpen(){return this.open}isFocused(){return this.focused}getAltTrigger(){return this.altTrigger}getEmitter(){return this.emitter}getParent(){return this.parent}setOpen(e){this.open=e,e&&this.setFocused(!1),this.submenu.forEach(t=>{t.setOpen(!1),e||t.setSelected(!1)}),a.setToggleClass(this.element,"open",e)}setFocused(e){this.focused=e,a.setToggleClass(this.element,"focused",e)}setParent(e){this.parent=e}addChild(e){var t;e.setParent(this),this.submenu.push(e),(t=this.element.querySelector(".menu-box"))==null||t.appendChild(e.getElement())}insertChild(e,t){var n;e.setParent(this),(n=this.submenu)==null||n.splice(t,0,e);let i=this.element.querySelector(".menu-box");i==null||i.insertBefore(e.getElement(),i.children[t]||null)}removeChild(e){var i,n,l,r,o;if(e instanceof v){(n=this.submenu)==null||n.splice((i=this.submenu)==null?void 0:i.indexOf(e),1),(l=e.getElement().parentElement)==null||l.removeChild(e.getElement());return}let t=(r=this.submenu)==null?void 0:r.splice(e,1)[0];(o=t==null?void 0:t.getElement().parentElement)==null||o.removeChild(t==null?void 0:t.getElement())}};var f=class{constructor(e,t){this.attentive=!1;this.showingAltKeys=!1;this.element=e,this.labels=[],this.emitter=new _.default,t&&(this.parent=t),this.emitter.on(y.MOUSE_CLICK,(...i)=>this.onLabelClicked(i[0],i[1])),this.emitter.on(y.MOUSE_ENTER,(...i)=>this.onLabelMouseEnter(i[0],i[1])),window.addEventListener("click",i=>this.blur()),atom.workspace.onDidChangeActivePaneItem(i=>this.blur()),document.body.addEventListener("keydown",i=>this.onKeyDown(i)),document.body.addEventListener("keyup",i=>this.onKeyUp(i))}static createApplicationMenu(e,t){let i=document.createElement("div");i.classList.add("app-menu");let n=new f(i,t);return n.labels=[],e.forEach(l=>{try{n.addLabel(S.createMenuLabel(l))}catch(r){console.error(r)}}),n}serialize(){return this.labels.map(e=>e.serialize())}onLabelClicked(e,t){if(e.isOpen()){e.setOpen(!1);return}this.labels.forEach(i=>{i.setOpen(!1)}),e.setOpen(!0)}onLabelMouseEnter(e,t){this.isOpen()&&!e.isOpen()&&g.configState.openAdjacent&&this.onLabelClicked(e,t)}onKeyDown(e){var n,l,r,o,p,b,w,O;if(!e.repeat&&(e.key==="Alt"||e.key==="Escape")&&(this.showingAltKeys||this.isOpen()||this.isFocused())){this.close(),(n=this.getFocusedLabel())==null||n.setFocused(!1),this.attentive=!1,this.showAltKeys(!1);return}if(e.key==="Alt"){if(e.repeat)return;this.attentive=!this.attentive,g.configState.menuBarMnemonics&&this.showAltKeys(!this.showingAltKeys);return}let t=this.getOpenLabel(),i=this.getFocusedLabel();if(t){let c=this.getSelectedLeaf();switch(e.key){case"ArrowUp":c?(r=(l=c.getParent())==null?void 0:l.getSubmenu())==null||r.selectPreviousItem():t.getSubmenu().selectLastItem(),a.stopEvent(e);return;case"ArrowDown":c?(p=(o=c.getParent())==null?void 0:o.getSubmenu())==null||p.selectNextItem():t.getSubmenu().selectFirstItem(),a.stopEvent(e);return;case"ArrowLeft":!c||c.getParent()instanceof S?this.openPreviousLabel():(b=c.getParent())==null||b.setOpen(!1),a.stopEvent(e);return;case"ArrowRight":!c||!c.hasSubmenu()?this.openNextLabel():(c.setOpen(!0),(w=c.getSubmenu())==null||w.selectFirstItem()),a.stopEvent(e);return;case"Enter":if(c&&!c.hasSubmenu()){c.execCommand(),this.close(),this.attentive=!1,this.showAltKeys(!1),a.stopEvent(e);return}break;case" ":if(c&&!c.hasSubmenu()){c.bounce(),c.execCommand(),a.stopEvent(e);return}break}if(this.showingAltKeys&&!e.repeat){let s=this.getOpenLeaf();if(s){let d=!1;if((O=s.getSubmenu())==null||O.getSelectable().some(E=>E.getAltTrigger()!==void 0&&E.getAltTrigger()===e.key.toLowerCase()?(E.execCommand(),this.close(),this.attentive=!1,this.showAltKeys(!1),a.stopEvent(e),d=!0,!0):!1),d)return}}}else{if(i)switch(e.key){case"Enter":case"ArrowDown":i.setOpen(!0),a.stopEvent(e);return;case"ArrowLeft":this.focusPreviousLabel(),a.stopEvent(e);return;case"ArrowRight":this.focusNextLabel(),a.stopEvent(e);return}if(this.showingAltKeys&&!e.repeat){let c=!1;if(this.labels.some(s=>s.getAltTrigger()!==void 0&&s.getAltTrigger()===e.key.toLowerCase()?(i&&i.setFocused(!1),s.setOpen(!0),a.stopEvent(e),c=!0,!0):!1),c)return}}this.attentive=!1,this.showAltKeys(!1)}onKeyUp(e){var t;e.key==="Alt"&&!this.isFocused()&&!this.isOpen()&&(this.showingAltKeys&&!g.configState.altGivesFocus&&!g.configState.autoHide&&this.showAltKeys(!1),this.attentive&&(g.configState.autoHide&&((t=this.parent)==null||t.setMenuBarVisible(!0)),(g.configState.autoHide||g.configState.altGivesFocus)&&this.focusFirstLabel()),this.attentive=!1)}blur(){var e;this.close(),(e=this.getFocusedLabel())==null||e.setFocused(!1),this.attentive=!1,this.showAltKeys(!1)}close(){var e;this.labels.forEach(t=>{t.isOpen()&&t.setOpen(!1)}),g.configState.autoHide&&((e=this.parent)==null||e.setMenuBarVisible(!1)),g.configState.menuBarMnemonics||(this.attentive=!0)}showAltKeys(e){a.setToggleClass(this.element,"alt-down",e),this.showingAltKeys=e}openFirstLabel(){var e;(e=this.labels[0])==null||e.setOpen(!0)}openLastLabel(){var e;(e=this.labels[this.labels.length-1])==null||e.setOpen(!0)}openNextLabel(){let e=this.getOpenLabel();e&&(e.setOpen(!1),this.labels[a.mod(this.labels.indexOf(e)+1,this.labels.length)].setOpen(!0))}openPreviousLabel(){let e=this.getOpenLabel();e&&(e.setOpen(!1),this.labels[a.mod(this.labels.indexOf(e)-1,this.labels.length)].setOpen(!0))}focusFirstLabel(){var e;this.labels.forEach(t=>{t.setFocused(!1)}),(e=this.labels[0])==null||e.setFocused(!0)}focusLastLabel(){var e;this.labels.forEach(t=>{t.setFocused(!1)}),(e=this.labels[this.labels.length-1])==null||e.setFocused(!0)}focusNextLabel(){let e=this.getFocusedLabel();e&&(e.setFocused(!1),this.labels[a.mod(this.labels.indexOf(e)+1,this.labels.length)].setFocused(!0))}focusPreviousLabel(){let e=this.getFocusedLabel();e&&(e.setFocused(!1),this.labels[a.mod(this.labels.indexOf(e)-1,this.labels.length)].setFocused(!0))}getOpenLeaf(){let e=null,t=i=>{var l;let n=null;return(l=i.getSubmenu())==null||l.some(r=>{if(r.hasSubmenu()&&r.isOpen()){n=r;let o=t(r);return o!==null&&(n=o),!0}return!1}),n};return this.labels.some(i=>{if(i.isOpen()){e=i;let n=t(i);return n!==null&&(e=n),!0}return!1}),e}getSelectedLeaf(){let e=null,t=i=>{var l;let n=null;return(l=i.getSubmenu())==null||l.some(r=>{if(r.isSelected()&&(n=r,r.hasSubmenu()&&r.isOpen())){let o=t(r);return o!==null&&(n=o),!0}return!1}),n};return this.labels.some(i=>{if(i.isOpen()){let n=t(i);return n!==null&&(e=n),!0}return!1}),e}getOpenLabel(){let e=null;return this.labels.some(t=>t.isOpen()?(e=t,!0):!1),e}getFocusedLabel(){let e=null;return this.labels.some(t=>t.isFocused()?(e=t,!0):!1),e}getElement(){return this.element}getLabels(){return this.labels}isOpen(){return this.getOpenLabel()!==null}isFocused(){return this.getFocusedLabel()!==null}getEmitter(){return this.emitter}addLabel(e){e.setParent(this),this.labels.push(e),this.element.appendChild(e.getElement())}insertLabel(e,t){var i;e.setParent(this),this.labels.splice(t,0,e),this.element.insertBefore(e.getElement(),((i=e.getElement().parentElement)==null?void 0:i.children[t])||null)}removeLabel(e){var i,n;if(e instanceof S){this.labels.splice(this.labels.indexOf(e),1),(i=e.getElement().parentElement)==null||i.removeChild(e.getElement());return}let t=this.labels.splice(e,1)[0];(n=t==null?void 0:t.getElement().parentElement)==null||n.removeChild(t==null?void 0:t.getElement())}};var W=k(require("electron"));var M;(function(u){u[u.NOOP=0]="NOOP",u[u.DELETE=1]="DELETE",u[u.INSERT=2]="INSERT",u[u.REPLACE=3]="REPLACE"})(M||(M={}));var R=class{constructor(e,t,i=(n,l)=>n===l){this.up={};this.down={};this.a=e,this.b=t,this.eqlFn=i,this.moda=new Array(e.length).fill(!1),this.modb=new Array(t.length).fill(!1),this.lcs(0,this.a.length,0,this.b.length)}createEditScript(){let e=0,t=0,i=this.moda.length,n=this.modb.length,l=[];for(;e<i||t<n;){if(e<i&&t<n){if(!this.moda[e]&&!this.modb[t]){l.push(0),e++,t++;continue}else if(this.moda[e]&&this.modb[t]){l.push(3),e++,t++;continue}}e<i&&(t>=n||this.moda[e])&&(l.push(1),e++),t<n&&(e>=i||this.modb[t])&&(l.push(2),t++)}return l}lcs(e,t,i,n){for(;e<t&&i<n&&this.eqlFn(this.a[e],this.b[i]);)e++,i++;for(;e<t&&i<n&&this.eqlFn(this.a[t-1],this.b[n-1]);)t--,n--;if(e===t)for(;i<n;)this.modb[i]=!0,i++;else if(n===i)for(;e<t;)this.moda[e]=!0,e++;else{let l=this.snake(e,t,i,n);this.lcs(e,l.x,i,l.y),this.lcs(l.u,t,l.v,n)}}snake(e,t,i,n){let l=t-e,r=n-i,o=e-i,p=t-n,w=(l-r&1)!=0;this.down[o+1]=e,this.up[p-1]=t;let O=(l+r)/2+1;for(let c=0;c<=O;c++){let s,d,E;for(s=o-c;s<=o+c;s+=2){for(s===o-c?d=this.down[s+1]:(d=this.down[s-1]+1,s<o+c&&this.down[s+1]>=d&&(d=this.down[s+1])),E=d-s;d<t&&E<n&&this.eqlFn(this.a[d],this.b[E]);)d++,E++;if(this.down[s]=d,w&&p-c<s&&s<p+c&&this.up[s]<=this.down[s])return{x:this.down[s],y:this.down[s]-s,u:this.up[s],v:this.up[s]-s}}for(s=p-c;s<=p+c;s+=2){for(s===p+c?d=this.up[s-1]:(d=this.up[s+1]-1,s>p-c&&this.up[s-1]<d&&(d=this.up[s-1])),E=d-s;d>e&&E>i&&this.eqlFn(this.a[d-1],this.b[E-1]);)d--,E--;if(this.up[s]=d,!w&&o-c<=s&&s<=o+c&&this.up[s]<=this.down[s])return{x:this.down[s],y:this.down[s]-s,u:this.up[s],v:this.up[s]-s}}}throw new Error("Unexpected state!")}};var L=class{static run(e){let t=JSON.parse(JSON.stringify(atom.menu.template));return t instanceof Array?(t.some(i=>{var n;return i.label==="&Packages"?((n=i.submenu)==null||n.sort((l,r)=>{if(l.label!==void 0&&r.label!==void 0){let o=l.label.toLowerCase(),p=r.label.toLowerCase();if(o<p)return-1;if(o>p)return 1}return 0}),!0):!1}),L.recurse(e,e.getLabels(),t)):(console.error("MenuUpdater: Menu template is malformed! Cannot perform menu update."),0)}static recurse(e,t,i){let n=0,r=new R(t,i,L.equals).createEditScript();return n+=L.execEditScript(e,t,i,r),t.forEach((o,p)=>{let b=o.getSubmenu(),w=i[p].submenu;if(b!==void 0){if(!(w instanceof Array)){console.error("MenuUpdater: malformed menu template item!",i[p]);return}n+=L.recurse(o,b,w)}}),n}static execEditScript(e,t,i,n){let l=0,r=0,o=n.length;return n.forEach(p=>{switch(p){case M.NOOP:l++,r++,o--;return;case M.DELETE:e instanceof f?e.removeLabel(l):e.removeChild(l);break;case M.INSERT:if(e instanceof f){let b=S.createMenuLabel(i[r]);e.insertLabel(b,l++)}else{let b=v.createMenuItem(i[r]);e.insertChild(b,l++)}r++;break;case M.REPLACE:if(e instanceof f){e.removeLabel(l);let b=S.createMenuLabel(i[r]);e.insertLabel(b,l++)}else{e.removeChild(l);let b=v.createMenuItem(i[r]);e.insertChild(b,l++)}break}}),o}static equals(e,t){return e===void 0||t===void 0?!1:e instanceof S?e.getLabelText()===t.label:e instanceof v?e.isSeparator()?t.type==="separator":e.getCommand()!==void 0?e.getCommand()===t.command:e.getLabelText()===t.label:!1}};var D=class{constructor(e){this.titleBarVisible=!0;this.menuBarVisible=!0;this.configState=e,this.themeManager=new h(this),[this.element,this.titleElmnt,this.windowControls]=this.createElement(),this.initWindowControls();let t=new MutationObserver((l,r)=>{l.forEach(o=>{o.type==="childList"&&this.setTitleText(o.target.textContent||"Atom")})}),i=document.querySelector("title");i!==null&&t.observe(i,{childList:!0});let n=atom.menu.template;this.appMenu=f.createApplicationMenu(n,this),this.element.appendChild(this.appMenu.getElement()),this.updateTitleText(),this.attachMenuUpdater(),atom.themes.onDidChangeActiveThemes(()=>{this.updateTransforms()})}createElement(){let e=document.createElement("div");e.classList.add("title-bar-replacer");let t=document.createElement("div");t.classList.add("tbr-title-bar");let i=document.createElement("span");i.classList.add("custom-title"),i.innerHTML="Atom",t.appendChild(i);let n=document.createElement("div");n.classList.add("control-wrap"),t.appendChild(n);let l=document.createElement("i");l.textContent="control_minimize",l.classList.add("tbr-minimize"),n.appendChild(l);let r=document.createElement("i");r.textContent="control_maximize",r.classList.add("tbr-maximize"),n.appendChild(r);let o=document.createElement("i");return o.textContent="control_close",o.classList.add("tbr-close"),n.appendChild(o),e.appendChild(t),[e,i,{minimize:l,maximize:r,close:o}]}async updateTransforms(){this.element.querySelectorAll(".menu-box.menu-item-submenu").forEach(e=>{var i;let t=(i=e.parentElement)==null?void 0:i.getBoundingClientRect();e.style.transform=`translate(${t.width-25}px, -3px)`})}attachMenuUpdater(){this.originalMenuUpdateFn===void 0&&(this.originalMenuUpdateFn=atom.menu.update),atom.menu.update=(...e)=>{var t;(t=this.originalMenuUpdateFn)==null||t.apply(atom.menu,...e),this.updateMenu()},this.updateMenu()}detachMenuUpdater(){this.originalMenuUpdateFn!==void 0&&(atom.menu.update=this.originalMenuUpdateFn)}updateMenu(){L.run(this.appMenu)>0&&(this.updateTransforms(),this.checkTitleCollision())}rebuildApplicationMenu(){var t;(t=this.appMenu.getElement().parentElement)==null||t.removeChild(this.appMenu.getElement());let e=atom.menu.template;this.appMenu=f.createApplicationMenu(e),this.element.appendChild(this.appMenu.getElement()),this.updateTransforms()}initWindowControls(){let e=W.remote.getCurrentWindow();e.on("maximize",()=>{this.windowControls.maximize.innerHTML="control_restore"}),e.on("unmaximize",()=>{this.windowControls.maximize.innerHTML="control_maximize"}),e.on("enter-full-screen",()=>{this.windowControls.maximize.classList.add("disabled"),this.configState.hideFullscreenTitle&&this.setTitleBarVisible(!1)}),e.on("leave-full-screen",()=>{this.windowControls.maximize.classList.remove("disabled"),this.configState.displayTitleBar&&this.setTitleBarVisible(!0)}),e.on("blur",()=>{document.body.click()}),e.on("resize",()=>{this.checkTitleCollision()}),this.windowControls.minimize.addEventListener("click",()=>{e.minimize()}),this.windowControls.maximize.addEventListener("click",()=>{e.isMaximized()?(e.unmaximize(),this.windowControls.maximize.innerHTML="control_maximize"):(e.maximize(),this.windowControls.maximize.innerHTML="control_restore")}),this.windowControls.close.addEventListener("click",()=>{e.close()}),e.isMaximized()?this.windowControls.maximize.innerHTML="control_restore":this.windowControls.maximize.innerHTML="control_maximize"}setTitleBarVisible(e){this.titleBarVisible=e,a.setToggleClass(this.element.querySelector(".tbr-title-bar"),"no-title-bar",!e),this.checkTitleCollision()}setMenuBarVisible(e){this.menuBarVisible=e,a.setToggleClass(this.appMenu.getElement(),"no-menu-bar",!e)}setTitleText(e){this.titleElmnt.innerHTML=e,this.checkTitleCollision()}updateTitleText(){let e=document.querySelector("title");e!==null&&(this.titleElmnt.innerHTML=e.textContent||"Atom",this.checkTitleCollision())}checkTitleCollision(){if(this.configState.titleBarStyle==="Compact"){let e=this.appMenu.getElement().getBoundingClientRect(),t=this.titleElmnt.getBoundingClientRect();a.domRectIntersects(e,t)?this.titleElmnt.style.visibility="hidden":this.titleElmnt.style.visibility="visible"}else this.titleElmnt.style.visibility="visible"}deactivate(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element),this.detachMenuUpdater()}getConfigState(){return this.configState}getThemeManager(){return this.themeManager}getElement(){return this.element}getApplicationMenu(){return this.appMenu}isTitleBarVisible(){return this.titleBarVisible}isMenuBarVisible(){return this.menuBarVisible}};var m=class{constructor(){this.initialized=!1;this.subscriptions=new j.CompositeDisposable}activate(e){this.titleBarReplacerView=new D(m.configState),this.initSubscriptions(),this.subscriptions.add(atom.workspace.observeActivePane(t=>{if(!this.initialized){let i=performance.now();atom.workspace.element.prepend(this.titleBarReplacerView.getElement()),this.titleBarReplacerView.updateTransforms(),this.initialized=!0}})),atom.inDevMode()&&(window.titleBarReplacer=this)}initSubscriptions(){this.subscriptions.add(atom.commands.add("atom-workspace",{"title-bar-replacer:toggle-title-bar":()=>{m.configState.displayTitleBar=!m.configState.displayTitleBar,this.titleBarReplacerView.setTitleBarVisible(m.configState.displayTitleBar)},"title-bar-replacer:toggle-menu-bar":()=>{m.configState.displayMenuBar=!m.configState.displayMenuBar,this.titleBarReplacerView.setMenuBarVisible(m.configState.displayMenuBar)},"title-bar-replacer:auto-select-colors":()=>{m.configState.autoSelectColor=!m.configState.autoSelectColor,m.configState.autoSelectColor?h.clearCustomColors():h.applyCustomColors()},"title-bar-replacer:run-menu-updater":()=>{this.titleBarReplacerView.updateMenu()},"title-bar-replacer:force-rebuild-application-menu":()=>{this.titleBarReplacerView.rebuildApplicationMenu()},"title-bar-replacer:remove-window-frame":async()=>{atom.confirm({message:"Title Bar Replacer",detailedMessage:`Hello old user! Thank you for still using title-bar-replacer. As of Atom v1.53 you no longer need to patch Atom in order to remove the window frame. You can now hide the native title bar by going to: 
Settings > Core > Title Bar
 And setting it to 'hidden'.`})}})),atom.config.observe("title-bar-replacer.general.displayTitleBar",e=>{m.configState.displayTitleBar=e,this.titleBarReplacerView.setTitleBarVisible(e)}),atom.config.observe("title-bar-replacer.general.displayMenuBar",e=>{m.configState.displayMenuBar=e,m.configState.autoHide||this.titleBarReplacerView.setMenuBarVisible(e)}),atom.config.observe("title-bar-replacer.general.openAdjacent",e=>{m.configState.openAdjacent=e}),atom.config.observe("title-bar-replacer.general.autoHide",e=>{m.configState.autoHide=e,e?this.titleBarReplacerView.setMenuBarVisible(!1):this.titleBarReplacerView.setMenuBarVisible(m.configState.displayMenuBar)}),atom.config.observe("title-bar-replacer.general.hideFullscreenTitle",e=>{m.configState.hideFullscreenTitle=e,atom.isFullScreen()&&this.titleBarReplacerView.setTitleBarVisible(!e)}),atom.config.observe("title-bar-replacer.general.altGivesFocus",e=>{m.configState.altGivesFocus=e}),atom.config.observe("title-bar-replacer.general.menuBarMnemonics",e=>{m.configState.menuBarMnemonics=e}),atom.config.observe("title-bar-replacer.colors.autoSelectColor",e=>{m.configState.autoSelectColor=e,e?h.clearCustomColors():h.applyCustomColors()}),atom.config.observe("title-bar-replacer.colors.baseColor",e=>{m.configState.baseColor=e,!m.configState.autoSelectColor&&this.initialized&&h.applyCustomColors()}),atom.config.observe("title-bar-replacer.colors.highlightColor",e=>{m.configState.highlightColor=e,!m.configState.autoSelectColor&&this.initialized&&h.applyCustomColors()}),atom.config.observe("title-bar-replacer.colors.textColor",e=>{m.configState.textColor=e,!m.configState.autoSelectColor&&this.initialized&&h.applyCustomColors()}),atom.config.observe("title-bar-replacer.colors.style",e=>{m.configState.titleBarStyle=e,this.titleBarReplacerView.getThemeManager().setTitleBarStyle(e),this.titleBarReplacerView.checkTitleCollision()}),atom.config.observe("title-bar-replacer.colors.controlTheme",e=>{m.configState.windowControlTheme=e,this.titleBarReplacerView.getThemeManager().setWindowControlTheme(e)}),atom.config.observe("title-bar-replacer.colors.controlLocation",e=>{m.configState.reverseWindowControls=e,this.titleBarReplacerView.getThemeManager().setReverseWindowControls(e)})}deactivate(){var e;(e=this.subscriptions)==null||e.dispose(),this.titleBarReplacerView.deactivate()}serialize(){}deserialize(e){}},g=m;g.configState=new H;var G={general:{order:1,type:"object",title:"General",properties:{displayTitleBar:{order:1,title:"Display Title Bar",description:"Determines whether or not the title bar should be displayed by default.",type:"boolean",default:!0},displayMenuBar:{order:2,title:"Display Menu Bar",description:"Determines whether or not the menu bar should be displayed by default. Overridden by 'Auto Hide'.",type:"boolean",default:!0},openAdjacent:{order:3,title:"Open Adjacent Categories On Hover",description:"Opens adjacent menu categories on mouse hover as long as a menu category is already open.",type:"boolean",default:!0},autoHide:{order:4,title:"Auto Hide Menu Bar",description:"Automatically hide the menu bar and toggle it by pressing Alt. Overrides 'Display Menu Bar'.",type:"boolean",default:!1},hideFullscreenTitle:{order:5,title:"Hide Title Bar in Fullscreen",type:"boolean",default:!0},altGivesFocus:{order:6,title:"Alt Gives Focus",description:"Releasing the alt key gives focus to the application menu.",type:"boolean",default:!0},menuBarMnemonics:{order:7,title:"Menu Bar Mnemonics",description:"Controls whether the application menu can be navigated with alt-key shortcuts.",type:"boolean",default:!0}}},colors:{order:2,type:"object",title:"Appearance",properties:{autoSelectColor:{order:1,title:"Automatically Select Title Bar Colors",description:"The ui-variables will be used as a base for the title bar design. <br/>If you untick this option you can use the following colors as a base:",type:"boolean",default:!0},baseColor:{order:2,title:"Base Color",description:"Color of the title bar background",type:"color",default:"#212326"},highlightColor:{order:3,title:"Highlight Color",description:"Color of the highlighted fields in the menu bar",type:"color",default:"#3A465B"},textColor:{order:4,title:"Text Color",description:"Base  for text and icons in the title bar",type:"color",default:"#a1adad"},style:{order:5,title:"Style",type:"string",enum:["Spacious","Compact"],default:"Compact"},controlTheme:{order:6,title:"Window Controls Theme",type:"string",enum:["Windows 10","Arc","Yosemite","Legacy"],default:"Windows 10"},controlLocation:{order:7,title:"Reverse Window Controls Location",type:"boolean",default:!1}}}};var V=new g;async function te(u){V.activate(u)}function ie(){V.deactivate()}function ne(){return V.serialize()}function le(u){console.log(u.data),V.deserialize(u.data)}
//# sourceMappingURL=title-bar-replacer.js.map
